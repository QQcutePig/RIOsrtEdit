# 🎬 RIOsrtEdit - 字幕編輯工具

**一個功能完整字幕編輯工具，支援 SRT/ASS/SSA 格式，內置簡繁體轉換、Word 模式、快照對比等強大功能。**

## 📋 目錄

- [功能概述](#-功能概述)
- [主要特性](#-主要特性)
- [使用技術](#-使用技術)
- [安裝與運行](#-安裝與運行)
- [功能詳解](#-功能詳解)
  - [字幕編輯模式](#1-字幕編輯模式)
  - [Word 文檔模式](#2-word-文檔模式)
  - [中文轉換功能](#3-中文轉換功能opencc)
  - [快照對比功能](#4-快照對比功能)
  - [批次轉換功能](#5-批次轉換功能)
- [OpenCC 依賴說明](#-opencc-依賴說明)
- [已知問題與修復](#-已知問題與修復)
- [貢獻指南](#-貢獻指南)
- [授權](#-授權)

## 🎯 功能概述

RIOsrtEdit 是一個功能豐富的線上字幕編輯工具，專為內容創作者、翻譯員和視頻製作人設計。它提供：

- ✅ **多格式支持**：SRT、ASS/SSA、TXT 等格式的導入導出
- ✅ **即時預覽**：邊編輯邊預覽字幕效果
- ✅ **簡繁轉換**：使用 OpenCC 庫進行精確的簡體字 ↔ 繁體字轉換
- ✅ **Word 模式**：A4 編輯、分頁、多樣化格式化
- ✅ **快照對比**：記錄編輯前後的差異，智能 diff 算法
- ✅ **批次轉換**：拖放多個檔案，一次過轉換並下載為 ZIP
- ✅ **專案儲存**：將編輯內容儲存為 .avrio.json 專案檔
- ✅ **響應式設計**：支援深色/淺色主題，適配各種屏幕尺寸

---

## ⭐ 主要特性

### 字幕編輯

- **網格視圖**：字幕序號、時間碼、內容三欄設計
- **快速編輯**：雙擊快速編輯單行字幕
- **時間調整**：支援 ±1秒、±0.1秒、±0.01秒 快捷按鈕
- **搜尋替換**：全文搜尋、替換、高亮顯示
- **撤銷重做**：保留完整編輯歷史

### Word 模式

- **A4 文檔編輯**：模擬 Word 軟體的文檔編輯體驗
- **分頁管理**：自動分頁、手動插入分頁符號
- **格式化工具**：
  - 標題（H1、H2、H3）、段落
  - 字體選擇、字號調整
  - 縮放控制（50% - 200%）
  - 邊距設置（頂、底、左、右）
- **搜尋功能**：在文檔內搜尋文字
- **匯出選項**：
  - TXT（純文字）
  - DOCX（使用 docx.js 庫）

### 中文處理

- **簡繁轉換**：基於 OpenCC.js，支援：
  - 簡體 → 繁體（香港、台灣、教育體系多種標準）
  - 繁體 → 簡體
  - 詞彙對應表：自動轉換常用詞彙（例：「软件」→「軟件」）
- **自動應用**：導入 ASS/SSA 檔案時自動檢測並轉換
- **選擇性開啟**：可於設定中啟用或禁用轉換功能

### 快照對比

- **版本追蹤**：拍攝編輯前快照，編輯後對比
- **智能 Diff**：
  - 識別新增行（綠色）
  - 識別刪除行（紅色）
  - 識別修改行（橙色） - 分別標記文字改動和時間改動
  - 識別不變行
- **高效算法**：使用 Map 加速匹配，O(n) 時間複雜度

### 批次轉換

- **拖放上傳**：拖拽多個 SRT/ASS/SSA 檔案到批次轉換區
- **進度條**：實時顯示轉換進度
- **ZIP 輸出**：全部檔案自動轉換並打包為 ZIP 下載

---

## 🛠️ 使用技術

### 核心技術
- **前端框架**：原生 HTML5 + CSS3 + JavaScript (ES6+)
- **編輯**：ContentEditable API
- **文件處理**：File API、Blob、URL.createObjectURL

### 關鍵庫（已內含）

| 庫名 | 版本 | 用途 | 位置 |
|------|------|------|------|
| **OpenCC.js** | 1.6.1+ | 簡繁中文轉換 | `/vendor/opencc-js/` |
| **JSZip** | 3.10+ | ZIP 打包創建 | `/vendor/jszip/` |
| **docx.js** | 8.5+ | DOCX 文檔生成 | `/vendor/docx/` |

### 實際檔案結構

```
RIOsrtEdit/
│
├── 📋 文檔檔案（新增到 GitHub）
│   ├── README-ZH.md                # ⭐ 主說明書（必須！）
│   ├── CODE-ANALYSIS.md            # 🔍 代碼分析
│   ├── FIX-SUMMARY.md              # 🔧 修復詳解
│   ├── CHANGELOG.md                # 📝 版本日誌（建議新建）
│   ├── LICENSE                     # ⚖️ MIT 授權（建議新建）
│   └── .gitignore                  # 🙈 Git 忽略（建議新建）
│
├── 🎬 核心應用檔案（已有）
│   ├── index.html                  # 主頁面
│   ├── app.js                      # 核心邏輯（含 4 項修復）
│   ├── style.css                   # 全局樣式
│   ├── snapshotCompare.js          # 快照對比（✅ 已修復）
│   ├── srt.js                      # SRT 解析
│   ├── fontSizeControl.js          # 字體控制
│   ├── timeCalc.js                 # 時間計算
│   ├── subtitle-icons.js           # 圖標管理
│   └── Open.bat                    # 本地運行腳本
│
├── 📚 中文轉換字典（OpenCC 核心！）
│   └── dict/
│       ├── STCharacters.txt        # 簡繁字符對應表（3000+ 字）
│       └── STPhrases.txt           # 簡繁詞彙對應表（10000+ 詞）
│
├── 📦 第三方庫（已有）
│   └── vendor/
│       ├── jszip/
│       │   └── jszip.min.js        # ZIP 打包庫
│       └── opencc/
│           ├── opencc-asm.js       # OpenCC 簡繁轉換引擎
│           ├── opencc-asm.js.mem   # OpenCC 內存數據
│           └── s2t.json            # 簡繁轉換表
│
└── 📝 Word 模式（15 個檔案）
    └── word-mode/
        ├── word-core.js            # 核心邏輯
        ├── word-data.js            # 數據管理
        ├── word-basic.js           # 基礎功能
        ├── word-advanced.js        # 進階功能（字體、縮放、邊距）
        ├── word-format.


---

## 📥 安裝與運行

### 方式 1：本地伺服器（推薦）

```bash
# 使用 Python 3
python -m http.server 8000

# 使用 Node.js http-server
npx http-server

# 使用 PHP
php -S localhost:8000
```

然後在瀏覽器開啟：`http://localhost:8000`

### 方式 2：直接開檔

由於應用使用 File API，某些功能在 `file://` 協議下會受限制。建議使用伺服器方式。

### 方式 3：部署到伺服器

將所有檔案上傳到 Web 伺服器（如 Nginx、Apache）即可運行，無需後端服務。

---

## 📖 功能詳解

### 1. 字幕編輯模式

#### 基本操作

1. **導入字幕**
   - 點擊「📂 載入字幕」按鈕
   - 選擇 SRT、ASS、SSA 或 TXT 檔案
   - 系統自動解析並顯示

2. **編輯字幕**
   - **方式 A**：直接在網格表中編輯
   - **方式 B**：雙擊某行，使用「快速編輯面板」
   - **方式 C**：使用「時間計算器」精確調整時間碼

3. **時間調整**
   - 使用「⏱️ 時間快速調整」按鈕：
     - `±3 秒`、`±1 秒`
     - `±0.1 秒`、`±0.01 秒`
   - 自動應用到全部字幕或單一行

4. **搜尋替換**
   - 點擊「🔍 搜尋」按鈕
   - 輸入搜尋詞並高亮顯示
   - 支援「全部替換」功能

5. **導出字幕**
   - 選擇格式：SRT 或 ASS
   - 點擊「⬇️ 下載 SRT」或「⬇️ 下載 ASS」
   - 自動生成檔名（帶日期戳記）

#### 快速編輯面板

快速編輯面板在側邊欄顯示，可以：
- 查看和編輯「時間碼」和「字幕內容」
- 使用「上一行」和「下一行」按鈕快速瀏覽
- 在「應用」後自動更新表格

---

### 2. Word 文檔模式

#### 功能介紹

Word 模式提供類似 Microsoft Word 的文檔編輯體驗，支援：

- **A4 頁面編輯**
- **自動分頁**
- **多樣化格式化**
- **頁邊距設置**
- **文檔導出**

#### 進入 Word 模式

1. 點擊右上角「📝 Word 模式」按鈕
2. 或點擊側邊欄「切換到 Word 模式」

#### 編輯工具

在右側工具欄找到：

**文字格式化**
- 字體選擇（預設字體列表）
- 字號調整（12px - 32px）

**頁面控制**
- 縮放控制（50% - 200%）
- 分頁翻頁：上一頁、下一頁、跳轉到指定頁
- 插入分頁符號

**邊距設置**
- 頂部、底部、左側、右側邊距
- 單位：cm（厘米）
- 預設：1.5cm

**樣式標記**
- 啟用「顯示樣式標記」來區分：
  - H1（紅色）、H2（橙色）、H3（黃色）、段落（綠色）

**白底模式**
- 勾選「白底模式」強制編輯區背景為白色（便於列印預覽）

#### 匯出文檔

Word 模式支援多種匯出格式：

1. **TXT（純文字）**
   - 點擊「⬇️ 下載 TXT」
   - 輸出純文字檔案，保留換行符

2. **DOCX（Word 文檔）**
   - 點擊「⬇️ 匯出 DOCX」
   - 使用 docx.js 庫生成完整 DOCX 檔案
   - 可在 Microsoft Word 中開啟編輯

#### 搜尋功能

在 Word 模式中搜尋：
1. 輸入搜尋詞到搜尋框
2. 自動高亮所有匹配項
3. 使用「上一個」和「下一個」導航
4. 支援「全部替換」功能

---

### 3. 中文轉換功能（OpenCC）

#### OpenCC 是什麼？

OpenCC（Open Chinese Convert）是一個開源中文繁簡轉換庫，由 BYVoid 開發。它基於龐大的詞彙對應表，能精確地進行：

- **簡體 → 繁體**：支援香港、台灣、教育體系等標準
- **繁體 → 簡體**：支援大陸簡體標準
- **詞彙對應**：例如「软件」→「軟件」、「鼠标」→「滑鼠」

#### RIOsrtEdit 如何使用 OpenCC

本應用內含 **OpenCC.js**（JavaScript 版本），位於 `/vendor/opencc-js/`

**自動轉換時機：**
1. 導入 ASS/SSA 檔案時 → 自動檢測並轉換字幕內容
2. 點擊「🔄 簡體轉繁體」或「🔄 繁體轉簡體」按鈕

**轉換流程：**
```javascript
// 示例代碼（app.js 內部）
if (openccConverter) {
    // openccConverter 是 OpenCC.js 的實例
    const convertedText = convertS2T(text); // 簡體→繁體
}
```

**轉換配置：**
- 預設使用「簡體 → 繁體（香港）」標準
- 可在設定中更換轉換標準（台灣、教育等）

#### 如何確保轉換成功

1. **檢查 vendor 資料夾**
   ```
   /vendor/opencc-js/
   ├── opencc.js           # 主庫
   ├── data/
   │   ├── s2hk.json      # 簡→香港繁
   │   ├── s2t.json       # 簡→台灣繁
   │   └── ... 其他轉換表
   └── ...
   ```

2. **載入順序**（在 index.html 中）
   ```html
   <!-- 必須在 app.js 之前載入 -->
   <script src="./vendor/opencc-js/opencc.js"></script>
   <script src="./app.js"></script>
   ```

3. **測試轉換**
   - 導入一個簡體 SRT 檔案
   - 如果字幕自動轉為繁體，表示成功 ✅
   - 如果未轉換，檢查瀏覽器控制台是否有錯誤訊息

#### OpenCC 依賴說明（重要！）

⚠️ **本項目依賴 OpenCC.js，但代碼本身不包含轉換數據**

如果轉換不生效，請：

1. **檢查 vendor 資料夾是否完整**
   - 確保 `/vendor/opencc-js/` 目錄存在
   - 確保內含 `opencc.js` 和 `data/` 資料夾

2. **手動載入 OpenCC（如遺漏）**
   ```bash
   # 從 GitHub 下載最新版本
   git clone https://github.com/BYVoid/OpenCC
   
   # 或使用 npm（如有 Node.js 環境）
   npm install opencc-js
   ```

3. **設定轉換函數**
   - 打開 `app.js`，搜尋 `openccConverter`
   - 確認轉換函數已正確初始化

---

### 4. 快照對比功能

#### 用途

快照對比用於追蹤字幕編輯前後的變化，特別適合：
- 多次編輯後想查看改動內容
- 團隊協作時核對修改點
- 版本管理和審核

#### 使用流程

1. **拍攝快照**
   - 點擊「📸 拍快照」按鈕
   - 系統記錄當前所有字幕行（序號、時間、內容）
   - 提示「已拍快照！記錄了 N 行字幕」

2. **編輯字幕**
   - 進行任何修改操作
   - 新增、刪除、修改字幕行

3. **對比查看**
   - 點擊「👀 對比」按鈕
   - 系統自動計算快照與現狀的差異
   - 以顏色標記：
     - 🟢 **綠色**：新增行
     - 🔴 **紅色**：已刪除行
     - 🟠 **橙色**：已修改行（時間或內容）

4. **返回編輯**
   - 點擊「✏️ 返回編輯」按鈕
   - 恢復到之前編輯狀態（不會撤銷修改，只是視圖切換）

#### Diff 算法

本應用採用「混合匹配策略」和性能優化：

**匹配優先級（序號）：**
1. **文字完全相同** → 判定為「相同」或「時間改動」
2. **時間相同** → 判定為「文字改動」
3. **既無文字相同、亦無時間相同** → 判定為「刪除」和「新增」

**性能優化：**
- 使用 `Map` 數據結構加速查詢（O(1) 時間複雜度）
- 避免了原生 `Array.findIndex()` 的 O(n²) 複雜度
- 大檔案對比（1000+ 行）可提升 10 倍速度

---

### 5. 批次轉換功能

#### 快速轉換多個檔案

批次轉換適合處理大量字幕檔案，一次過轉換為同一格式。

#### 使用步驟

1. **進入批次轉換**
   - 點擊「🔄 批次轉換」標籤
   - 或點擊「拖放多個字幕檔案到此區域」

2. **拖放檔案**
   - 拖拽一個或多個 SRT/ASS/SSA 檔案到批次區域
   - 檔案會自動列出並顯示檔案名

3. **開始轉換**
   - 選擇輸出格式（通常轉為 SRT）
   - 點擊「▶️ 開始轉換」按鈕
   - 實時進度條顯示轉換進度

4. **下載 ZIP**
   - 轉換完成後自動下載 `batch_srt.zip`
   - ZIP 內包含所有轉換後的檔案
   - 檔名保留原名，副檔名改為 `.srt`

#### 轉換配置

- **輸出格式**：SRT（推薦）、ASS（如需保留樣式）
- **簡繁轉換**：勾選「自動簡體轉繁體」應用 OpenCC 轉換
- **編碼**：自動識別（UTF-8 優先）

---

## 🔐 已知問題與修復

### 修復清單（v1.5.0）

本版本包含 **9 項重要 bug 修復**：

| 優先級 | 問題 | 修復方式 | 狀態 |
|--------|------|---------|------|
| 🔴 高 | `parseInt` 缺 `, 10` 參數 | 新增進制指定 | ✅ 已修 |
| 🔴 高 | DOM selector 漏 `#` | 修正 selector | ✅ 已修 |
| 🔴 高 | null reference 錯誤 | 加 null check | ✅ 已修 |
| 🟡 中 | JSZip 檢查不完整 | 檢查 `.generateAsync` | ✅ 已修 |
| 🟡 中 | 檔案處理無異常捕捉 | 加 try-catch | ✅ 已修 |
| 🟡 中 | 批次處理無保護 | 加 try-catch | ✅ 已修 |
| 🟡 中 | 定時器浪費 CPU | 改事件驅動 | ✅ 已修 |
| 🟡 中 | JSON 解析無保護 | 加 try-catch | ✅ 已修 |
| 🟢 低 | Diff 性能差 O(n²) | 用 Map 改 O(n) | ✅ 已修 |

### 已知限制

1. **瀏覽器兼容性**
   - 需要 ES6+ 支援（IE 11 不支援）
   - 推薦：Chrome 90+、Firefox 88+、Safari 14+

2. **文件大小**
   - 單個檔案上限：~500MB（取決於瀏覽器記憶體）
   - 推薦：單個字幕檔案 <100MB

3. **時間碼精度**
   - 支援精度：毫秒（0.001 秒）
   - ASS/SSA 額外支援帧號（centisecond）

---

## 🤝 貢獻指南

歡迎提交 Issue 和 Pull Request！

### 開發流程

1. **Fork 本倉庫**
2. **建立功能分支**
   ```bash
   git checkout -b feature/your-feature-name
   ```
3. **提交修改**
   ```bash
   git commit -m "feat: 添加某某功能"
   ```
4. **推送到分支**
   ```bash
   git push origin feature/your-feature-name
   ```
5. **提交 Pull Request**

### 代碼規範

- 使用 ES6+ 語法
- 變數命名：camelCase（JavaScript）、kebab-case（CSS）
- 註釋：中文或英文清楚說明邏輯
- 測試：修改前後需測試相關功能

### 報告 Bug

遇到問題？提交 Issue 時請包含：
- 瀏覽器版本
- 重現步驟
- 錯誤訊息（F12 控制台）
- 預期行為 vs 實際行為

---

## 📄 授權

MIT License

**簡述：** 自由使用、修改、分發本軟體，但需保留原作者信息。

---

## 📞 聯絡方式

- **問題回報**：GitHub Issues
- **功能建議**：GitHub Discussions
- **郵件聯絡**：（待補充）

---

## 🙏 致謝

感謝以下開源項目的貢獻：

- **OpenCC**：中文繁簡轉換 (https://github.com/BYVoid/OpenCC)
- **JSZip**：ZIP 檔案生成 (https://stuk.github.io/jszip/)
- **docx.js**：DOCX 文檔生成 (https://github.com/VolkovRA/docx)

---
# 本地伺服器啟動批處理檔 (.bat)

## 📌 檔案用途
呢個批處理檔用嚟快速啟動一個本地 HTTP 伺服器，方便測試同瀏覽專案內容。

## ⚙️ 執行流程
- 切換到批處理檔所在目錄
- 顯示目錄檔案清單
- 提示伺服器啟動中
- 自動打開瀏覽器連結 [http://127.0.0.1:5173](http://127.0.0.1:5173)
- 使用 Python 建立本地伺服器 (`python -m http.server 5173`)

## 🛡️ 安全注意事項
- 此檔案 **只會影響本機**，唔會自動連接外部伺服器。
- 請避免將敏感檔案（例如密碼、私密資料）放喺同一資料夾，否則伺服器開啟後可能被瀏覽器讀取。
- GitHub **唔會自動執行**此檔案，只有使用者手動執行先會生效。
- 建議只用於學習或測試用途。

## 🚀 使用方法
1. 確保已安裝 Python  
2. 下載或 clone 專案  
3. 執行 `.bat` 檔案  
4. 瀏覽器會自動打開 [http://127.0.0.1:5173](http://127.0.0.1:5173)

## 📄 License
此檔案僅供學習及示範用途，請勿用於生產環境。

**最後更新**：2026年1月13日

**版本**：v1.5.0 (含完整修復)

祝你使用愉快！如有問題歡迎反饋。🚀
