<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RIOsrtEdit MVP</title>
  <link rel="stylesheet" href="./style.css" />
    <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Word 模式樣式 -->
  <link rel="stylesheet" href="word-mode/word-style.css">

</head>

<body>
<div id="subtitleMode">
<header class="topbar">
  <div class="app-title">RIOsrtEdit (MVP)</div>

  <div class="toolbar" role="toolbar" aria-label="工具列">
    <button id="btnNewFile" title="新增空白檔案">📝</button>
    <button id="btnOpenProj" title="開啟專案📂：讀取 .avrio.json">📂</button>
    <button id="btnSaveProj" title="儲存專案💾：保存為 .avrio.json">💾</button>
	<button id="btnSaveProjAs" title="另存新檔">📑</button>
	<button id="btnWordMode" title="Word 模式">📄</button>


    <span class="sep"></span>

    <button id="btnOpen" title="匯入📥：開啟 TXT/SRT/ASS/SSA">📥</button>
	<button id="btnExportSrt" title="匯出">📥</button>

    <!-- 影片匯入：一定要保留呢粒 id="btnVideo" -->
    <button id="btnVideo" type="button" title="匯入影片">📺</button>

    <span class="sep"></span>

    <button id="btnUndo" title="復原↩️（Ctrl+Z）">↩️</button>
    <button id="btnRedo" title="重做↪️（Ctrl+Y / Ctrl+Shift+Z）">↪️</button>

    <span class="sep"></span>

    <button id="btnInsLine" title="插入新字幕（Insert）">➕</button>
    <button id="btnDelLine" title="刪除字幕（Delete）">➖</button>

    <span class="sep"></span>

    <button id="btnConvert" title="轉換🔄：簡轉繁（OpenCC s2t）" disabled>🔄</button>
<button id="btnFontSizeDown" title="縮小字幕文字 (A-)">A-</button>
<button id="btnFontSizeUp" title="放大字幕文字 (A+)">A+</button>
<span class="sep"></span>

    <button id="btnSearch" title="搜尋取代🔎" disabled>🔎</button>
    <button id="btnMagicWand" title="魔術筆工具">✨</button>
    <button id="btnKeepZh" title="移除外文🌐：每條字幕只保留中文（自動簡轉繁，保留時間）">🌐</button>

    <span class="sep"></span>

    <button id="btnBatch" title="批次處理📚" disabled>📚</button>

    <span class="sep"></span>

    <button id="btnStars" title="書籤★：顯示/收起書籤清單">⭐</button>
    <button id="btnTheme" title="暗/亮主題切換🌚🌞">🌚🌞</button>
  </div>
</header>

  <main class="main">
    <section class="left">
      <div class="panel-title">字幕內容</div>

      <div id="gridWrap" class="gridWrap">
        <div class="gridHeader">
          <div>#</div>
          <div>★</div>
          <div>時間</div>
          <div>文字</div>
        </div>
<div id="gridBody" class="gridBody"></div>
<!-- 快速編輯按鈕（左下角，圓形 ICON） -->
<button id="quickEditToggle" class="quickEditIcon" type="button" title="快速編輯">⚡</button>

<!-- 快速編輯區（彈出面板） -->
<div id="quickEdit" class="quickEditPanel" style="display: none;">
  <div class="quickEditContent">
    <!-- 第一行：起始、持續、結束 + 上一行 -->
    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
      <label style="font-size: 11px; color: var(--muted); white-space: nowrap; min-width: 40px;">起始</label>
      <button type="button" id="qeStartMinus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">-1s</button>
      <input type="text" id="qeStart" readonly style="width: 85px; text-align: center; height: 24px; font-size: 11px; padding: 2px;" />
      <button type="button" id="qeStartPlus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">+1s</button>
      
      <label style="font-size: 11px; color: var(--muted); white-space: nowrap; margin-left: 6px; min-width: 40px;">持續</label>
      <button type="button" id="qeDurMinus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">-1s</button>
      <input type="text" id="qeDuration" readonly style="width: 50px; text-align: center; height: 24px; font-size: 11px; padding: 2px;" />
      <button type="button" id="qeDurPlus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">+1s</button>
      
      <label style="font-size: 11px; color: var(--muted); white-space: nowrap; margin-left: 6px; min-width: 40px;">結束</label>
      <button type="button" id="qeEndMinus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">-1s</button>
      <input type="text" id="qeEnd" readonly style="width: 85px; text-align: center; height: 24px; font-size: 11px; padding: 2px;" />
      <button type="button" id="qeEndPlus1" style="height: 24px; padding: 0 4px; font-size: 11px; min-width: 28px;">+1s</button>
      
      <button type="button" id="qePrev" style="height: 24px; padding: 0 10px; font-size: 12px; margin-left: 8px; white-space: nowrap;">上一行</button>
    </div>

    <!-- 第二行：字幕內容 + 下一行 + 套用 -->
    <div style="display: flex; align-items: center; gap: 6px;">
      <label style="font-size: 11px; color: var(--muted); white-space: nowrap; min-width: 40px;">字幕</label>
      <textarea id="qeText" rows="1" style="flex: 1; width: 497px; vertical; min-height: 24px; height: 24px; font-size: 14px; line-height: 1.3; padding: 4px 6px;"></textarea>
           <button type="button" id="qeApply" style="height: 24px; padding: 0 10px; font-size: 12px; background: #5aa7ff; color: #fff; font-weight: 500; white-space: nowrap;">套用</button>

	 <button type="button" id="qeNext" style="height: 24px; padding: 0 10px; font-size: 12px; white-space: nowrap;">下一行</button>
    </div>
  </div>
</div>

      <textarea id="editor" spellcheck="false" placeholder="（raw 文字區已隱藏/不用）"></textarea>

      <div class="statusbar">
        <div id="statusLeft">未載入檔案</div>
        <div id="statusRight">UTF-8</div>
      </div>
    </section>

    <section class="right">
      <div class="panel-title">工具</div>

      <div class="card">
        <div class="card-title">檔案</div>
        <div class="row">
          <input id="fileInput" type="file" accept=".srt,.txt,.ass,.ssa" hidden />
          <input id="projInput" type="file" accept=".json,.avrio,.avrio.json" hidden />
          <button id="btnOpen2" type="button">選擇檔案…</button>
          <button id="btnClear" type="button">清空</button>
        </div>
        <div class="hint">提示：OpenCC ready 後「轉換🔄」按鈕會由灰變可按。</div>
      </div>

      <div class="card">
        <div class="card-title">快速測試</div>
        <div class="row">
          <button id="btnFillTest" type="button">填入測試文字</button>
        </div>
        <div class="hint">測試文字會包含簡體字，方便驗證簡轉繁。</div>
      </div>
    </section>
  </main>

  <!-- Stars popup -->
  <div id="starsPanel" class="card hidden" role="dialog" aria-label="書籤">
    <div class="card-title">★ 書籤</div>
    <div class="row">
      <button id="btnStarsRefresh" type="button" title="更新">更新</button>
    </div>
    <div id="starsList" class="hint">（未有書籤）</div>
  </div>

  <!-- Edit dialog -->
  <div id="dlgMask" class="dlgMask hidden"></div>
  <div id="dlg" class="dlg hidden" role="dialog" aria-modal="true" aria-label="編輯字幕行">
    <div class="dlgTitle">編輯字幕行</div>
    <div class="dlgGrid">
<label for="dlgStart">開始</label>
<div style="display: flex; gap: 4px; align-items: center;">
  <input id="dlgStart" placeholder="00:00:01,000" style="flex: 1;">
  <button type="button" id="btnStartMinus3" title="-3秒" style="padding: 4px 8px; font-size: 11px;">-3s</button>
  <button type="button" id="btnStartMinus2" title="-2秒" style="padding: 4px 8px; font-size: 11px;">-2s</button>
  <button type="button" id="btnStartMinus1" title="-1秒" style="padding: 4px 8px; font-size: 11px;">-1s</button>
  <button type="button" id="btnStartPlus1" title="+1秒" style="padding: 4px 8px; font-size: 11px;">+1s</button>
  <button type="button" id="btnStartPlus2" title="+2秒" style="padding: 4px 8px; font-size: 11px;">+2s</button>
  <button type="button" id="btnStartPlus3" title="+3秒" style="padding: 4px 8px; font-size: 11px;">+3s</button>
  <input id="dlgStartCustom" type="number" placeholder="秒" style="width: 50px; padding: 4px;" step="0.1">
  <button type="button" id="btnStartCustom" title="套用自訂秒數" style="padding: 4px 8px;">套用</button>
</div>

<label for="dlgEnd">結束</label>
<div style="display: flex; gap: 4px; align-items: center;">
  <input id="dlgEnd" placeholder="00:00:02,000" style="flex: 1;">
  <button type="button" id="btnEndMinus3" title="-3秒" style="padding: 4px 8px; font-size: 11px;">-3s</button>
  <button type="button" id="btnEndMinus2" title="-2秒" style="padding: 4px 8px; font-size: 11px;">-2s</button>
  <button type="button" id="btnEndMinus1" title="-1秒" style="padding: 4px 8px; font-size: 11px;">-1s</button>
  <button type="button" id="btnEndPlus1" title="+1秒" style="padding: 4px 8px; font-size: 11px;">+1s</button>
  <button type="button" id="btnEndPlus2" title="+2秒" style="padding: 4px 8px; font-size: 11px;">+2s</button>
  <button type="button" id="btnEndPlus3" title="+3秒" style="padding: 4px 8px; font-size: 11px;">+3s</button>
  <input id="dlgEndCustom" type="number" placeholder="秒" style="width: 50px; padding: 4px;" step="0.1">
  <button type="button" id="btnEndCustom" title="套用自訂秒數" style="padding: 4px 8px;">套用</button>
</div>

<label for="dlgDuration">持續時間</label>
<div style="display: flex; gap: 4px; align-items: center;">
  <input id="dlgDuration" type="number" placeholder="秒數" style="width: 80px; padding: 8px;" step="0.1">
  <button type="button" id="btnDurationApply" title="調整結束時間以符合此持續時間" style="padding: 6px 12px;">套用至結束</button>
  <span style="color: var(--muted); font-size: 12px;">(只修改結束時間)</span>
</div>
	  
      <label for="dlgText">文字</label>
      <textarea id="dlgText" rows="4" spellcheck="false"></textarea>

      <label for="dlgTimeMode">時間模式</label>
      <select id="dlgTimeMode">
        <option value="absolute">改成指定時間（自動帶動整段）</option>
        <option value="relative">只用平移（時分秒+毫秒）</option>
      </select>

      <div class="shiftLabel">平移</div>
      <div class="shiftWrap">
        <div class="shiftRow">
          <div class="shiftCell">
            <div class="shiftCap">時</div>
            <input id="dlgShiftHour" placeholder="0" />
          </div>
          <div class="shiftCell">
            <div class="shiftCap">分</div>
            <input id="dlgShiftMinute" placeholder="0" />
          </div>
          <div class="shiftCell">
            <div class="shiftCap">秒</div>
            <input id="dlgShiftSec" placeholder="-2 / 1" />
          </div>
          <div class="shiftCell">
            <div class="shiftCap">毫秒</div>
            <input id="dlgShiftMs" placeholder="0 / 250" />
          </div>
        </div>
      </div>

      <label for="dlgScope">套用範圍</label>
      <select id="dlgScope">
        <option value="only">只改本行</option>
        <option value="down">本行 + 向下全部</option>
        <option value="up">本行 + 向上全部</option>
      </select>
    </div>

<div class="dlgBtns">
  <button id="dlgCancel" type="button">取消</button>
  <button id="dlgOk" type="button">確定</button>
    <button id="dlgApply" type="button" style="background: #5aa7ff; color: #fff;">套用</button>

</div>
    <div class="dlgHint">提示：時間格式必須係 00:00:00,000（逗號+三位毫秒）。</div>
  </div>

<!-- 搜尋 / 取代 -->
<div id="findMask" class="dlgMask hidden"></div>
<div id="findDlg" class="dlg hidden">
  <div class="dlgTitle">搜尋 / 取代</div>
  <div class="dlgGrid">
    <label>搜尋</label>
    <input id="findQ" type="text" placeholder="輸入要搜尋的文字">
    <label>取代</label>
    <input id="findR" type="text" placeholder="取代成…">
  </div>
  <div class="dlgBtns">
    <button type="button" id="btnFindPrev">上一個</button>  <!-- ← 新增 -->
    <button type="button" id="btnFindNext">下一個</button>
    <button type="button" id="btnReplaceOne">取代</button>
    <button type="button" id="btnReplaceAll">全部取代</button>  <!-- ← 改文字 -->
    <span id="findInfo" style="margin-left:auto;color:var(--muted);font-size:12px;">0/0</span>
    <button type="button" id="btnFindClose">關閉</button>
  </div>
</div>

  <!-- Batch dialog -->
  <div id="batchMask" class="dlgMask hidden"></div>
  <div id="batchDlg" class="dlg hidden" role="dialog" aria-modal="true" aria-label="批次處理">
    <div class="dlgTitle">批次處理 📚（拖入 / 選檔 → 轉 SRT → ZIP）</div>

    <div class="row" style="gap:8px; display:flex; flex-wrap:wrap;">
      <button id="btnBatchPick" type="button">選擇檔案…</button>
      <button id="btnBatchRun" type="button" disabled>開始</button>
      <button id="btnBatchClose" type="button">關閉</button>
      <input id="batchInput" type="file" multiple accept=".srt,.ass,.ssa,.txt" hidden />
    </div>

    <div id="batchDrop" class="card" style="border:1px dashed var(--border); border-radius:12px; padding:12px;">
      拖曳檔案到呢度（可多個）
    </div>

    <div class="hint" id="batchInfo" style="margin-top:8px;">未選擇檔案</div>

    <div style="margin-top:10px;">
      <progress id="batchProg" value="0" max="100" style="width:100%;"></progress>
      <div class="hint" id="batchProgText">0%</div>
    </div>
  </div>
<!-- 魔術筆工具 Dialog -->
<div id="magicMask" class="dlgMask hidden"></div>
<div id="magicDlg" class="dlg hidden" style="max-width: 480px;">
  <div class="dlgTitle">🪄 魔術筆工具</div>
  <div style="padding: 12px 0;">
    <div style="margin-bottom: 10px; color: var(--muted); font-size: 12px;">
      選擇要套用的功能（可多選）：
    </div>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicRemoveSpaces"> 移除多餘空格
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicToFullPunc"> 標點符號轉全形
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicToHalfPunc"> 標點符號轉半形
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicRemoveFullPunc"> 移除所有標點符號（全形）
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicRemoveHalfPunc"> 移除所有標點符號（半形）
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicNumToFull"> 數字轉全形
    </label>
    <label style="display: block; margin: 8px 0; cursor: pointer;">
      <input type="checkbox" id="magicNumToHalf"> 數字轉半形
    </label>
	<label style="display: block; margin: 8px 0; cursor: pointer;">
  <input type="checkbox" id="magicRemoveEmpty" />
  移除空白行
</label>
<label style="display: block; margin: 8px 0; cursor: pointer;">
  <input type="checkbox" id="magicSortByTime" />
  ⏰ 按時間排序
</label>

  </div>
  <div class="dlgBtns">
    <button type="button" id="btnMagicCancel">取消</button>
    <button type="button" id="btnMagicApply">套用</button>
  </div>
  <div id="magicPreview" style="margin-top: 12px; padding: 10px; background: var(--panel2); border-radius: 8px; max-height: 200px; overflow-y: auto; font-size: 12px; color: var(--muted); display: none;">
    <!-- 預覽區域 -->
  </div>
</div>
<!-- Export Format Dialog -->
<div id="exportMask" class="dlgMask hidden"></div>
<div id="exportDlg" class="dlg hidden" role="dialog" aria-modal="true" aria-label="選擇匯出格式">
  <div class="dlgTitle">📥 選擇匯出格式</div>
  
  <div style="padding: 20px 0;">
    <label style="display: block; margin: 12px 0; cursor: pointer; font-size: 14px;">
      <input type="radio" name="exportFormat" value="srt" checked style="margin-right: 8px;">
      SRT 格式
    </label>
    <label style="display: block; margin: 12px 0; cursor: pointer; font-size: 14px;">
      <input type="radio" name="exportFormat" value="txtWithTime" style="margin-right: 8px;">
      TXT (含時間)
    </label>
    <label style="display: block; margin: 12px 0; cursor: pointer; font-size: 14px;">
      <input type="radio" name="exportFormat" value="txtPlain" style="margin-right: 8px;">
      TXT (純文字)
    </label>
  </div>
  
  <div class="dlgBtns">
    <button type="button" id="btnExportCancel">取消</button>
    <button type="button" id="btnExportConfirm">確定</button>
  </div>
</div>

  <!-- Floating video player (ONLY ONE copy) -->
  <!-- ===== NOTE PANEL (記事本) ===== -->
<div id="notePanel" class="notePanel hidden">
  <div class="notePanelHeader">
    <div class="notePanelTitle">📝 記事本</div>
    <button type="button" id="btnNoteImport" title="匯入 TXT" style="padding: 4px 8px; font-size: 11px;">📥</button>
    <button type="button" id="btnNoteExport" title="匯出 TXT" style="padding: 4px 8px; font-size: 11px;">📤</button>
    <button type="button" id="btnNoteToggle" class="notePanelClose">▼</button>
  </div>
  <div class="notePanelBody">
    <textarea id="noteText" class="noteTextarea" placeholder="在此輸入筆記..."></textarea>
  </div>
</div>
<input type="file" id="noteImportInput" accept=".txt" style="display:none;">

<!-- NOTE ICON (記事本圖標 - 深黃色) -->
<button id="btnNote" class="noteIcon" title="記事本">📝</button>

  <div id="videoFloat" class="videoFloat videoCollapsed hidden">
    <div class="videoFloatHeader">
      <button id="btnVideoToggle" type="button" class="videoToggleBtn" title="展開/收埋（收埋會暫停）">◀</button>
      <div class="videoFloatTitle">VIDEO</div>
      <button id="btnVideoPick" type="button" class="videoPickBtn" title="匯入影片">選擇影片</button>
      <input id="videoInput" type="file" accept="video/*" class="hidden" />
    </div>

<div class="videoFloatBody">
  <div class="videoWrapper">
    <video id="videoEl" class="videoEl" preload="metadata"></video>
    <div id="videoSubtitle" class="videoSubtitle"></div>
  </div>
  <input type="range" class="videoSeek" min="0" max="100" value="0">
  <div class="videoMiniControls">
    <button id="btnVBack3" type="button">⏪3</button>
    <button id="btnVBack2" type="button">⏪2</button>
    <button id="btnVBack1" type="button">⏪1</button>
    <button id="btnVPlay" type="button">⏯</button>
    <button id="btnVFwd1" type="button">⏩1</button>
    <button id="btnVFwd2" type="button">⏩2</button>
    <button id="btnVFwd3" type="button">⏩3</button>
  </div>
</div>

    </div>
  </div>
<!-- ========== Time Calculator ========== -->
<div class="timeCalcIcon" id="timeCalcIcon" title="時間計算器">⏱️</div>

<div class="timeCalcPanel hidden" id="timeCalcPanel">
  <div class="timeCalcHeader" id="timeCalcHeader">
    <span class="timeCalcTitle">Time Calculator</span>
  </div>
  
  <div class="timeCalcBody">
    <!-- 計算顯示區 -->
    <div class="timeCalcDisplay">
      <div class="timeCalcRow" id="tcRow1">0h 0min 0sec 0ms</div>
      <div class="timeCalcRow" id="tcRow2">+</div>
      <div class="timeCalcRow" id="tcRow3">0h 0min 0sec 0ms</div>
      <div class="timeCalcRow tcResult" id="tcRow4">= 0h 0min 0sec 0ms</div>
    </div>
    
    <!-- 轉換結果區 -->
    <div class="timeCalcConversion hidden" id="tcConversion">
      <div class="tcConvRow">Total Hours: <span id="tcHours">-</span></div>
      <div class="tcConvRow">Total Minutes: <span id="tcMinutes">-</span></div>
      <div class="tcConvRow">Total Seconds: <span id="tcSeconds">-</span></div>
      <div class="tcConvRow">Total Ms: <span id="tcMs">-</span></div>
    </div>
    
    <!-- 數字鍵盤 - 新佈局 -->
    <div class="timeCalcKeypad">
      <!-- 第1行：單位鍵 -->
      <button type="button" class="tcUnit" data-unit="h">hour</button>
      <button type="button" class="tcUnit" data-unit="m">min</button>
      <button type="button" class="tcUnit" data-unit="s">sec</button>
      <button type="button" class="tcUnit" data-unit="ms">m.sec</button>
      
      <!-- 第2行：7 8 9 C -->
      <button type="button" class="tcKey" data-val="7">7</button>
      <button type="button" class="tcKey" data-val="8">8</button>
      <button type="button" class="tcKey" data-val="9">9</button>
      <button type="button" class="tcOp" data-op="clear">C</button>
      
      <!-- 第3行：4 5 6 + -->
      <button type="button" class="tcKey" data-val="4">4</button>
      <button type="button" class="tcKey" data-val="5">5</button>
      <button type="button" class="tcKey" data-val="6">6</button>
      <button type="button" class="tcOp" data-op="+">+</button>
      
      <!-- 第4行：1 2 3 - -->
      <button type="button" class="tcKey" data-val="1">1</button>
      <button type="button" class="tcKey" data-val="2">2</button>
      <button type="button" class="tcKey" data-val="3">3</button>
      <button type="button" class="tcOp" data-op="-">-</button>
      
      <!-- 第5行：轉換 歷史 0 = -->
      <button type="button" class="tcSpecial" id="timeCalcConvert" title="轉換格式">⇄</button>
      <button type="button" class="tcSpecial" id="timeCalcHistory" title="歷史記錄">🕐</button>
      <button type="button" class="tcKey" data-val="0">0</button>
      <button type="button" class="tcOp" data-op="=">=</button>
    </div>
  </div>
</div>

<!-- 歷史記錄面板（計算機右側） -->
<div class="timeCalcHistoryPanel hidden" id="tcHistoryPanel">
  <div class="tcHistoryHeader">
    <span class="tcHistoryTitle">📋 計算歷史</span>
    <button type="button" class="tcHistoryClose" id="tcHistoryClose">✕</button>
  </div>
  <div class="tcHistoryList" id="tcHistoryList">
    <div class="tcHistoryEmpty">暫無歷史記錄</div>
  </div>
  <div class="tcHistoryFooter">
    <button type="button" class="tcHistoryClear" id="tcHistoryClear">清空全部</button>
  </div>
</div>
<!-- ✅ 快照對比 ICON -->
    <div class="snapshotIcon" id="snapshotIcon" title="快照對比">📸</div>
<!-- 快照對比浮動面板 -->
<div class="snapshotPanel hidden" id="snapshotPanel">
    <div class="snapshotPanelHeader">
        <span class="snapshotPanelTitle">📸 快照對比</span>
        <button type="button" class="snapshotPanelClose" id="snapshotPanelClose">✕</button>
    </div>
    <div class="snapshotPanelBody">
        <button type="button" id="btnSnapshot" class="snapshotBtn" title="拍攝當前狀態">📸 拍快照</button>
        <button type="button" id="btnCompare" class="snapshotBtn" disabled title="與快照對比">👀 對比</button>
        <button type="button" id="btnBackToEdit" class="snapshotBtn" disabled title="返回編輯模式">✏️ 返回編輯</button>
        
        <!-- ✨ 顏色說明 ✨ -->
        <div style="margin-top: 16px; padding: 12px; background: var(--panel2); border-radius: 6px; font-size: 12px; line-height: 1.8;">
            <div style="font-weight: bold; margin-bottom: 8px; color: var(--fg);">顏色說明:</div>
            <div style="display: flex; align-items: center; margin: 4px 0;">
                <span style="display: inline-block; width: 16px; height: 16px; background: rgba(0, 255, 0, 0.3); border-radius: 3px; margin-right: 8px;"></span>
                <span style="color: var(--muted);">新增行</span>
            </div>
            <div style="display: flex; align-items: center; margin: 4px 0;">
                <span style="display: inline-block; width: 16px; height: 16px; background: rgba(255, 0, 0, 0.3); border-radius: 3px; margin-right: 8px;"></span>
                <span style="color: var(--muted);">刪除行</span>
            </div>
            <div style="display: flex; align-items: center; margin: 4px 0;">
                <span style="display: inline-block; width: 16px; height: 16px; background: rgba(255, 200, 0, 0.3); border-radius: 3px; margin-right: 8px;"></span>
                <span style="color: var(--muted);">修改行</span>
            </div>
        </div>
    </div>
</div>
<!-- Word 對話框（獨立） -->
<!-- Word 匯入對話框（新版） -->
<div id="wordImportMask" class="wordMask" style="display: none;"></div>
<div id="wordImportDlg" class="wordDlg" style="display: none;">
  <div class="wordDlgHeader">
    <span class="wordDlgTitle">📄 匯入字幕到 Word 模式</span>
  </div>
  
  <div class="wordDlgBody">
    <p class="wordDlgHint">選擇如何將字幕轉換到 Word 文件：</p>
    
    <label class="wordOption">
      <input type="radio" name="wordImportMode" value="withTime" checked>
      <div class="wordOptionContent">
        <div class="wordOptionTitle">📋 含時間模式</div>
        <div class="wordOptionDesc">顯示時間碼（適合翻譯/校對）</div>
      </div>
    </label>
    
    <label class="wordOption">
      <input type="radio" name="wordImportMode" value="textOnly">
      <div class="wordOptionContent">
        <div class="wordOptionTitle">📝 純文字模式</div>
        <div class="wordOptionDesc">只顯示字幕文字（適合閱讀）</div>
      </div>
    </label>
    
    <label class="wordOption">
      <input type="radio" name="wordImportMode" value="blank">
      <div class="wordOptionContent">
        <div class="wordOptionTitle">📄 建立空白文件</div>
        <div class="wordOptionDesc">清空內容，重新開始</div>
      </div>
    </label>
    
    <label class="wordOption">
      <input type="radio" name="wordImportMode" value="noChange">
      <div class="wordOptionContent">
        <div class="wordOptionTitle">↩️ 完全不變更</div>
        <div class="wordOptionDesc">保持 Word 原有內容</div>
      </div>
    </label>
  </div>
  
  <div class="wordDlgFooter">
    <button id="wordImportCancel" class="wordBtn wordBtnSecondary">取消</button>
    <button id="wordImportConfirm" class="wordBtn wordBtnPrimary">確定</button>
  </div>
</div>

<!-- Word 匯出對話框（新版） -->
<div id="wordExportMask" class="wordMask" style="display: none;"></div>
<div id="wordExportDlg" class="wordDlg" style="display: none;">
  <div class="wordDlgHeader">
    <span class="wordDlgTitle">📤 回傳文字到字幕模式</span>
  </div>
  
  <div class="wordDlgBody">
    <p class="wordDlgHint">選擇如何處理 Word 文件中的內容：</p>
    
    <label class="wordOption">
      <input type="radio" name="wordExportMode" value="update" checked>
      <div class="wordOptionContent">
        <div class="wordOptionTitle">🔄 更新字幕時間碼</div>
        <div class="wordOptionDesc">解析 [00:00:00,000] 並更新</div>
      </div>
    </label>
    
    <label class="wordOption">
      <input type="radio" name="wordExportMode" value="keep">
      <div class="wordOptionContent">
        <div class="wordOptionTitle">📝 保留原有時間碼</div>
        <div class="wordOptionDesc">只更新文字內容</div>
      </div>
    </label>
    
    <label class="wordOption">
      <input type="radio" name="wordExportMode" value="noChange">
      <div class="wordOptionContent">
        <div class="wordOptionTitle">↩️ 完全不變更</div>
        <div class="wordOptionDesc">保持字幕原有內容</div>
      </div>
    </label>
  </div>
  
  <div class="wordDlgFooter">
    <button id="wordExportCancel" class="wordBtn wordBtnSecondary">取消</button>
    <button id="wordExportConfirm" class="wordBtn wordBtnPrimary">確定</button>
  </div>
</div>

<!-- Word 模式容器（預設隱藏） -->
<div id="wordMode">
  <!-- Word 頂部工具列 -->
  <div class="word-topbar">
    <span class="app-title">📝 Word 模式</span>
    <button id="btnBackToSubtitle" class="word-btn" title="返回字幕模式">← 返回</button>
	<button id="btnOpenProjWord" class="word-btn" title="開啟專案">開啟專案</button>
<button id="btnSaveProjWord" class="word-btn" title="儲存專案">儲存專案</button>
<button id="btnSaveProjWordAs" title="另存新檔">另存新檔</button>
<!-- 放喺 btnSaveProjWordAs 後面、btnThemeWord 前面 -->
<button id="btnWordImportTxt" class="word-btn" title="匯入 TXT">匯入TXT</button>
<button id="btnWordExportTxtTop" class="word-btn" title="匯出 TXT">匯出TXT</button>
<button id="wordBtnExportDocx" type="button">匯出 DOCX</button>
<input id="wordTxtInput" type="file" accept=".txt,text/plain" hidden>

<button id="btnThemeWord" class="word-btn" title="切換主題">🌓</button>
  </div>

  <!-- Word 主區域 -->
  <div class="word-main">
    <!-- 左側：編輯區 -->
    <div class="word-editor-container">
      <div class="word-pages">
        <div class="word-page">
          <div class="word-content" contenteditable="true" id="wordEditor">
            <!-- 編輯內容會喺呢度 -->
          </div>
        </div>
      </div>
    </div>

<!-- 右側：工具列 (25%) -->
<div class="word-sidebar">
  
  <!-- 基本功能 -->
  <div class="word-tool-section">
    <div class="word-tool-title">基本功能</div>
    <div class="word-tool-grid" style="grid-template-columns: repeat(4, 1fr);">
      <button class="word-tool-btn" id="wordBtnSymbols" title="特殊符號">
        <span class="material-icons">insert_emoticon</span>
      </button>
      <button class="word-tool-btn" id="wordBtnHighlight" title="螢光筆">
        <span class="material-icons">border_color</span>
      </button>
      <button class="word-tool-btn" id="wordBtnTextColor" title="文字顏色">
        <span class="material-icons">format_color_text</span>
      </button>
      <button class="word-tool-btn" id="wordBtnWhiteMode" title="白底模式">
        <span class="material-icons">light_mode</span>
      </button>
      
      <!-- 第二行 -->
      <button class="word-tool-btn" id="wordBtnInsertImage" title="插入圖片">
        <span class="material-icons">image</span>
      </button>
      <button class="word-tool-btn" id="wordBtnInsertTable" title="插入表格">
        <span class="material-icons">table_chart</span>
      </button>
      <button class="word-tool-btn" id="wordBtnOrderedList" title="編號清單">
        <span class="material-icons">format_list_numbered</span>
      </button>
      <button class="word-tool-btn" id="wordBtnPrint" title="列印">
        <span class="material-icons">print</span>
      </button>
    </div>
  </div>
    <!-- 剪貼簿 -->
  <div class="word-tool-section">
    <div class="word-tool-title">剪貼簿</div>
    <div class="word-tool-grid">
      <button class="word-tool-btn" id="wordBtnCopy" title="複製 (Ctrl+C)">
        <span class="material-icons">content_copy</span>
      </button>
      <button class="word-tool-btn" id="wordBtnPaste" title="貼上 (Ctrl+V)">
        <span class="material-icons">content_paste</span>
      </button>
      <button class="word-tool-btn" id="wordBtnPastePlain" title="貼上純文字">
        <span class="material-icons">content_paste_go</span>
      </button>
      <button class="word-tool-btn" id="wordBtnClearFormat" title="清除格式">
        <span class="material-icons">format_clear</span>
      </button>
    </div>
  </div>

<div class="word-tool-section">
  <div class="word-tool-title">文字</div>

  <div class="word-row-inline">
    <label class="word-label">大小
      <select id="wordFontSizeSelect" class="word-select">
<option value="6">6</option>
<option value="8">8</option>
<option value="10">10</option>
<option value="12">12</option>
<option value="14" selected>14</option>
<option value="16">16</option>
<option value="18">18</option>
<option value="20">20</option>
<option value="22">22</option>
<option value="24">24</option>
<option value="26">26</option>
<option value="28">28</option>
<option value="30">30</option>
<option value="32">32</option>
<option value="36">36</option>
<option value="48">48</option>
<option value="72">72</option>
      </select>
    </label>

    <label class="word-label">字型
      <select id="wordFontFamilySelect" class="word-select">
        <option value="inherit" selected>跟隨預設</option>
        <option value="Arial">Arial</option>
        <option value="'Times New Roman', Times, serif">Times New Roman</option>
        <option value="'Microsoft JhengHei', 'PingFang TC', sans-serif">微軟正黑 / PingFang</option>
        <option value="'PMingLiU', serif">新細明體</option>
        <option value="'Noto Sans TC', sans-serif">Noto Sans TC</option>
        <option value="'Noto Serif TC', serif">Noto Serif TC</option>
      </select>
    </label>
  </div>
  <!-- 文字格式 -->
  <div class="word-tool-section">
    <div class="word-tool-title">文字格式</div>
    <div class="word-tool-grid">
      <button class="word-tool-btn" id="wordBtnBold" title="粗體 (Ctrl+B)">
        <span class="material-icons">format_bold</span>
      </button>
      <button class="word-tool-btn" id="wordBtnItalic" title="斜體 (Ctrl+I)">
        <span class="material-icons">format_italic</span>
      </button>
      <button class="word-tool-btn" id="wordBtnUnderline" title="底線 (Ctrl+U)">
        <span class="material-icons">format_underlined</span>
      </button>
      <button class="word-tool-btn" id="wordBtnStrike" title="刪除線">
        <span class="material-icons">strikethrough_s</span>
      </button>
    </div>
  </div>

  <!-- 對齊方式 -->
  <div class="word-tool-section">
    <div class="word-tool-title">對齊方式</div>
    <div class="word-tool-grid">
      <button class="word-tool-btn" id="wordBtnAlignLeft" title="靠左">
        <span class="material-icons">format_align_left</span>
      </button>
      <button class="word-tool-btn" id="wordBtnAlignCenter" title="置中">
        <span class="material-icons">format_align_center</span>
      </button>
      <button class="word-tool-btn" id="wordBtnAlignRight" title="靠右">
        <span class="material-icons">format_align_right</span>
      </button>
      <button class="word-tool-btn" id="wordBtnAlignJustify" title="齊行">
        <span class="material-icons">format_align_justify</span>
      </button>
    </div>
  </div>

<!-- 行距 -->
<div class="word-tool-section">
  <div class="word-tool-title">行距</div>
  <div class="word-tool-grid" style="grid-template-columns: repeat(6, 1fr);">
    <button class="word-tool-btn" id="wordBtnLineHeight08" title="行距 0.8">
      <span class="material-icons" style="font-size: 16px;">view_headline</span>
    </button>
    <button class="word-tool-btn" id="wordBtnLineHeight1" title="行距 1.0">
      <span class="material-icons" style="font-size: 16px;">format_align_justify</span>
    </button>
    <button class="word-tool-btn" id="wordBtnLineHeight15" title="行距 1.5">
      <span class="material-icons" style="font-size: 16px;">density_small</span>
    </button>
    <button class="word-tool-btn" id="wordBtnLineHeight2" title="行距 2.0">
      <span class="material-icons" style="font-size: 16px;">density_medium</span>
    </button>
    <button class="word-tool-btn" id="wordBtnLineHeight25" title="行距 2.5">
      <span class="material-icons" style="font-size: 16px;">density_large</span>
    </button>
    <button class="word-tool-btn" id="wordBtnLineHeight3" title="行距 3.0">
      <span class="material-icons" style="font-size: 16px;">vertical_distribute</span>
    </button>
  </div>
</div>

<!-- 標題樣式 -->
<div class="word-tool-section">
  <div class="word-tool-title">標題樣式</div>
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;">
    <button class="word-tool-btn" id="wordBtnH1" title="標題 1" style="font-size: 13px; font-weight: 600;">
      H1
    </button>
    <button class="word-tool-btn" id="wordBtnH2" title="標題 2" style="font-size: 13px; font-weight: 600;">
      H2
    </button>
    <button class="word-tool-btn" id="wordBtnH3" title="標題 3" style="font-size: 13px; font-weight: 600;">
      H3
    </button>
    <button class="word-tool-btn" id="wordBtnParagraph" title="內文" style="font-size: 13px; font-weight: 600;">
      P
    </button>
  </div>
  
  <!-- 樣式標記切換 -->
  <div style="margin-top: 8px;">
    <label style="display: flex; align-items: center; gap: 8px; font-size: 12px; cursor: pointer; user-select: none;">
      <input type="checkbox" id="wordToggleStyleMarkers" style="cursor: pointer;">
      <span>顯示樣式標記</span>
    </label>
  </div>
</div>

<!-- 版面 -->
<div class="word-tool-section">
  <div class="word-tool-title">縮放</div>
  <div style="display:flex; gap:6px; align-items:center;">
    <button class="word-tool-btn" id="wordBtnZoomOut" title="縮小">
      <span class="material-icons">zoom_out</span>
    </button>

    <select id="wordZoomSelect" style="flex:1; padding:6px; border-radius:6px;">
      <option value="0.5">50%</option>
      <option value="0.75">75%</option>
      <option value="1" selected>100%</option>
      <option value="1.25">125%</option>
      <option value="1.5">150%</option>
      <option value="2">200%</option>
    </select>

    <button class="word-tool-btn" id="wordBtnZoomIn" title="放大">
      <span class="material-icons">zoom_in</span>
    </button>
  </div>
</div>

<!-- 頁面邊距 -->
<div class="word-tool-section">
  <div class="word-tool-title">頁面邊距 (cm)</div>
  <div class="word-margin-single-row">
    <input type="number" id="wordMarginTop" value="1.5" min="0" max="5" step="0.1" title="上邊距">
    <input type="number" id="wordMarginRight" value="1.5" min="0" max="5" step="0.1" title="右邊距">
    <input type="number" id="wordMarginBottom" value="1.5" min="0" max="5" step="0.1" title="下邊距">
    <input type="number" id="wordMarginLeft" value="1.5" min="0" max="5" step="0.1" title="左邊距">
  </div>
  <button class="word-tool-btn word-margin-apply" id="wordBtnApplyMargin">套用邊距</button>
</div>


<!-- Word 搜尋 & 取代 -->
<!-- 搜尋 & 取代 -->
<div class="word-tool-section">
  <div class="word-tool-title">搜尋 & 取代</div>
  <input type="text" class="word-search-input" id="wordFindInput" placeholder="搜尋..." style="margin-bottom: 6px;">
  <input type="text" class="word-search-input" id="wordReplaceInput" placeholder="取代為..." style="margin-bottom: 8px;">
  
  <div class="word-tool-grid" style="grid-template-columns: repeat(4, 1fr);">
    <button class="word-tool-btn" id="wordBtnFindPrev" title="上一個">
      <span class="material-icons" style="font-size: 18px;">chevron_left</span>
    </button>
    <button class="word-tool-btn" id="wordBtnFindNext" title="下一個">
      <span class="material-icons" style="font-size: 18px;">chevron_right</span>
    </button>
    <button class="word-tool-btn" id="wordBtnReplaceOne" title="取代">
      <span class="material-icons" style="font-size: 18px;">check</span>
    </button>
    <button class="word-tool-btn" id="wordBtnReplaceAll" title="全部取代">
      <span class="material-icons" style="font-size: 18px;">done_all</span>
    </button>
  </div>
  
  <div class="word-search-info" id="wordSearchInfo" style="margin-top: 6px;">0/0</div>
</div>
  
</div>


</div>
<!-- 上面結束 word-sidebar -->
</div>
<!-- 上面結束 word-main ⬅️ 加呢個！ -->
<!-- 底部狀態列 -->
<div class="word-statusbar" style="display: flex; align-items: center; justify-content: space-between; padding: 6px 12px;">
  <span id="wordStatsLeft" style="font-size: 12px;">字數: 0 | 段落: 0</span>
  
  <!-- 分頁控制（嵌入） -->
  <div style="display: flex; align-items: center; gap: 8px;">
    <button class="word-btn" id="wordBtnPrevPage" title="上一頁" style="padding: 4px 8px; font-size: 12px;">
      <span class="material-icons" style="font-size: 16px;">chevron_left</span>
    </button>
    
    <span style="font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 4px;">
      <input type="number" id="wordCurrentPage" value="1" min="1" style="width: 40px; text-align: center; padding: 2px 4px; font-size: 12px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: 4px;">
      / <span id="wordTotalPages">1</span>
    </span>
    
    <button class="word-btn" id="wordBtnNextPage" title="下一頁" style="padding: 4px 8px; font-size: 12px;">
      <span class="material-icons" style="font-size: 16px;">chevron_right</span>
    </button>
    
    <button class="word-btn" id="wordBtnInsertPageBreak" title="插入分頁" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">
      <span class="material-icons" style="font-size: 16px;">horizontal_rule</span>
    </button>
  </div>
  
  <span id="wordStatsRight" style="font-size: 12px;">頁數: 1/1</span>
</div>

</div>
<!-- 上面結束 #wordMode -->
<!-- 🆕 Word 模式 DOCX 匯出支援 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- Scripts -->
  <script src="./vendor/opencc/opencc-asm.js"></script>
  <script src="./srt.js"></script>
  <script src="./vendor/jszip/jszip.min.js"></script>
  <script src="./vendor/docx/docx.umd.js"></script>
  <script src="./app.js"></script>
  <script src="./subtitle-icons.js"></script>

  <script src="./fontSizeControl.js"></script>
  <script src="timeCalc.js"></script>
  <script src="./snapshotCompare.js"></script>
  <!-- Word 模式 JS -->
  <script src="word-mode/word-core.js"></script>
  <script src="word-mode/word-basic.js"></script>
  <script src="word-mode/word-advanced.js"></script>
  <script src="word-mode/word-format.js"></script>
  <script src="word-mode/word-data.js"></script>
  <script src="word-mode/word-search.js"></script>
  <script src="word-mode/word-export.js"></script>
  <script src="word-mode/word-style-markers.js"></script>
  <script src="word-mode/word-pagination.js"></script>
<script src="word-mode/word-history.js"></script>
<script src="word-mode/word-extra.js"></script> 
<script src="word-mode/word-topbar-io.js"></script>

</body>

</body>
</html>
